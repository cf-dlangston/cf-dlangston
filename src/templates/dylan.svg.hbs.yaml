#
# This file defines the markup used to create the 'dylan.svg' file. It uses 
# YAML instead of XML to define the structure of the SVG. How does this work?
# First we parse this file using 'js-yaml', then use the resulting object to 
# invoke methods for 'SVG.js'. (See https://svgjs.dev/docs/3.0/ for more.)
# We also use 'Handlebars' to populate variables at build time.
#
# This use of SVG+YAML allows for greater legibility and additional post-
# processing techniques to improve the size of the final SVG. This approach is 
# entirely bespoke and while novel is likely to have unforseen pitfalls. That 
# said please feel free to give it a try if you're interested by downloading
# the source code, navigating to the "src" directory and running:
#   npm install
#   npm run test
#

# Define basic SVG attributes
width: {{width}}
height: {{height}}
viewBox: 0 0 {{width}} {{height}}
preserveAspectRatio: xMinYMin none

Fadein Style:
  style: |
    svg {
      opacity: 1;
      animation: fade-in 150ms;
    }
    @keyframes fade-in {
      0% {
        opacity: 0.01;
      }
      100% {
        opacity: 1;
      }
    }

# Style to ensure foreignObjects inherit their parent element style
ForeignObject Style:
  style: |
    foreignObject html, .inherit {
      width: inherit;
      height: inherit;
      background: inherit;
      border-radius: inherit;
      border-color: inherit;
      border-width: inherit;
      border-style: inherit;
      padding: inherit;
      margin: inherit;
      animation: inherit;
      display: content;
    }

# Style defines the background image and it's associated blur filter
Background style:
  defs:
    defs:
    addDef: |
      <filter 
        id="blur_filter" 
        x="0%" y="0%" 
        width="100%" height="100%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="5" />
      </filter>
  style: |
    .background {
      width: inherit;
      height: inherit;
      background-size: calc({{width}}px - 10px) calc({{height}}px - 10px);
      background-repeat: no-repeat;
      background-image: url("{{{files.bliss_webp}}}");
      background-position: center;
    }

Background:
  foreignObject:
    foreignObject: [{{width}}, {{height}}]
    attr: [ "filter", "url(#blur_filter)"]
    addClass: background
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 
    css: 
      border-radius: 75px 75px 15px 15px;

# Style defines the hair background gradient
Hair Style:
  defs:
    defs: 
    addDef: |
      <radialGradient id="hair_gradient" cx="0.5" cy="0.5" r="0.5" fx="0.5" fy="0.5">
        <stop offset="0%" stop-color="{{hair1}}" />
        <stop offset="100%" stop-color="{{hair2}}" />
      </radialGradient>
  style: [
    '.hair',
    {
      fill: url(#hair_gradient),
      background: 'radial-gradient({{hair1}}, {{hair2}})'
    }
  ]

Hair Back:
  foreignObject: 
    foreignObject: [ 400, 450 ]
    x: 100
    y: 25
    addClass: 'hair'
    css:
      border-radius: 50% 50% 50% 50%/35% 35% 65% 65%;
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 

Hair Back Left:
  ellipse: 
    ellipse: [ 200, 350 ]
    x: 80
    y: 190
    addClass: 'hair'

Hair Back Left 2:
  ellipse: 
    ellipse: [ 100, 200 ]
    x: 80
    y: 120
    addClass: 'hair'

Hair Back Right:
  ellipse: 
    ellipse: [ 150, 350 ]
    x: 380
    y: 120
    addClass: 'hair'

# Style defines the shirt image 
Shirt style:
  style: |
    .shirt-background {
      background-color: {{shirt}};
      background-size: 560px;
      background-repeat: no-repeat;
      background-image: url("{{{files.solo_webp}}}");
    }
    .shirt-body {
      background-position: bottom center;
      clip-path: polygon(0 0, 100% 0, 100% 30%, 88% 45%, 88% 100%, 12% 100%, 12% 45%, 0% 30%);
    }

Arm style:
  style: |
    .arm-left {
      background-position: bottom 20px left;
      border-radius: 50% 50% 0 0;
    }
    .arm-right {
      animation: arm-right-radius-animation 3s infinite;
      background-position: bottom right;
    }
    @keyframes arm-right-radius-animation {
      0%, 50%, 100% {
        border-radius: 30% 50% 25% 25%;
      }
      25%, 75% {
        border-radius: 30% 50% 25% 35%;
      }
    } 
    .move-left-arm {
      transform-origin: 100px 590px;
      transform: rotate(4deg);
    }
    .move-right-arm {
      transform-origin: 485px 590px;
      animation: right-arm-animation 3s infinite;
    }
    @keyframes right-arm-animation {
      0%, 50%, 100% {
        transform: rotate(-25deg);
      }
      25%, 75% {
        transform: rotate(-75deg);
      }
    }  

Shirt:
  foreignObject: 
    foreignObject: [ 500, 300 ]
    x: 50
    y: 500
    css:
      border-radius: 25% 25% 0 0;
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="shirt-background shirt-body"/>' 

Arm Left:
  foreignObject: 
    foreignObject: [ 100, 280 ]
    x: 20
    y: 540
    addClass: 'move-left-arm'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="shirt-background arm-left"/>' 

Forearm style:
  style: |
    .forearm {
      background: {{shirt}};
      animation: forearm-radius-animation 3s infinite;
    }
    @keyframes forearm-radius-animation {
      0%, 50%, 100% {
        border-radius: 25% 25% 40% 10px;
      }
      25%, 75% {
        border-radius: 25% 25% 50% 10px;
      }
    } 
    .forearm-wave {
      transform-origin: 555px 735px;
      
      animation: forearm-animation 3s infinite;
    }
    @keyframes forearm-animation {
      0%, 50%, 100% {
        transform: rotate(80deg) translate(-10px, -40px);
      }
      25%, 75% {
        transform: rotate(20deg) translate(30px, -150px);
      }
    }  

Forearm Right:
  foreignObject: 
    foreignObject: [ 90, 225 ]
    x: 550
    y: 540
    addClass: 'forearm-wave'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="forearm"/>'

Arm Right:
  foreignObject: 
    foreignObject: [ 100, 260 ]
    x: 475
    y: 540
    addClass: 'move-right-arm'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="shirt-background arm-right"/>'

Arm Pit Left:
  foreignObject: 
    foreignObject: [ 102, 280 ]
    x: 20
    y: 540
    addClass: 'move-left-arm'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" style="margin-top: 110px; height: 170px; width: 100px;border-right: 2px solid {{collar}};animation: unset"/>'

# Hand: 
#   foreignObject: 
#     foreignObject: [ 200, 200 ]
#     x: 20
#     y: 540
#     addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="foInherit" style="font-size: 100px">üñêüèª</html>'

Collar style:
  style: |
    .collar {
      background: transparent;
      height: 75px;
      width: 95px;
      border-radius: 50%;
      border-bottom: 3px solid {{collar}};
    }

Collar:
  foreignObject: 
    foreignObject: [ 95, 35 ]
    x: 249.5
    y: 460
    addClass: 'collar'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 

Hair Front Right:
  foreignObject: 
    foreignObject: [ 160, 150 ]
    x: 380
    y: 360
    addClass: 'hair'
    attr: [ 'transform', 'rotate(20, 380, 360)' ]
    css: 
      border-radius: 50% 50% 37% 50%;
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 

Head:
  foreignObject: 
    foreignObject: [ 400, 400 ]
    x: 100
    y: 50
    css:
      border-radius: 50% 50% 50% 50%/44% 44% 56% 56%;
      background: '{{skin1}}'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 

Neck:
  foreignObject: 
    foreignObject: [ 75, 80 ]
    x: 260
    y: 440
    css:
      border-radius: 0 0 25% 25%;
      background: '{{skin1}}'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 

Head Depth:
  foreignObject: 
    foreignObject: [ 380, 400 ]
    x: 110
    y: 50
    css:
      border-radius: 50% 50% 50% 50%/44% 44% 56% 56%;
      background: '{{skin2}}'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 

Neck Depth:
  foreignObject: 
    foreignObject: [ 65, 80 ]
    x: 265
    y: 440
    css:
      border-radius: 0 0 25% 25%;
      background: '{{skin2}}'
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml"/>' 

Hair Front Left:
  ellipse: 
    ellipse: [ 12, 150 ]
    x: 98
    y: 160
    addClass: 'hair'

Hair Front Right 2:
  ellipse: 
    ellipse: [ 12, 150 ]
    x: 490
    y: 160
    addClass: 'hair'

Hair Front Middle:
  ellipse: 
    ellipse: [ 200, 13 ]
    x: 200
    y: 47
    addClass: 'hair'

Eye Left:
  circle:
    circle: 70
    fill: '{{eye}}'
    x: 175
    y: 110

Eye Right:
  circle:
    circle: 70
    fill: '{{eye}}'
    x: 350
    y: 110

Tear Duct Left:
  ellipse:
    ellipse: [7, 5]
    fill: '{{tearDuct}}'
    x: 236
    y: 158

Tear Duct Right:
  ellipse:
    ellipse: [7, 5]
    fill: '{{tearDuct}}'
    x: 352
    y: 158

# Style defines the iris background gradient
Iris Style:
  defs:
    defs: 
    addDef: |
      <radialGradient id="iris_gradient" cx="0.5" cy="0.5" r="0.5" fx="0.5" fy="0.5">
        <stop offset="0%" stop-color="{{iris1}}" />
        <stop offset="20%" stop-color="{{iris2}}" />
        <stop offset="85%" stop-color="{{iris3}}" />
        <stop offset="100%" stop-color="{{iris4}}" />
      </radialGradient>
  style: [
    '.iris',
    {
      fill: url(#iris_gradient),
      background: 'radial-gradient({{iris1}},{{iris2}},{{iris3}},{{iris4}})'
    }
  ]

Iris Left:
  circle:
    circle: 50
    x: 185
    y: 120
    addClass: iris

Iris Right:
  circle:
    circle: 50
    x: 360
    y: 120
    addClass: iris

# Animation of the pupil moving left/right and increasing in size
Pupil Animation:
  style: |
    @keyframes pupil-animation {
      0%, 10%, 39%, 100% {
        transform: translate(0px, 0px);
      },
      2%, 33% {
        transform: translate(-1.5px, 0px);
        stroke: {{pupil}};
        stroke-width: 3px;
      },
      7%, 36% {
        transform: translate(1.5px, 0px);
      }
    }  

# Style applies the pupil animation
Pupil Style:
  style: [
    '.pupil',
    {
      animation: 'pupil-animation 10s infinite;',
      stroke: transparent,
      fill: '{{pupil}}'
    }
  ]

Pupil Left:
  circle:
    circle: 25
    x: 197.5
    y: 132.5
    addClass: pupil

Pupil Right:
  circle:
    circle: 25
    x: 372.5
    y: 132.5
    addClass: pupil

Eyelid Left: 
  ellipse:
    ellipse: [120, 60]
    fill: transparent
    x: 150
    y: 115
    stroke: {
      color: '{{skin2}}',
      width: 20,
      linecap: round
    }

Eyelid Right: 
  ellipse:
    ellipse: [120, 60]
    fill: transparent
    x: 325
    y: 115
    stroke: {
      color: '{{skin2}}',
      width: 20,
      linecap: round
    }

# Eyelid closing animations
Eyelid Animation:
  style: |
    @keyframes eyelid-top-animation {
      0%, 90%, 100% {
        transform: translateY(0px);
      }
      92% {
        transform: translateY(20px);
      }
    }
    @keyframes eyelid-bottom-animation {
      0%, 90%, 100% {
        transform: translateY(0px);
      }
      92% {
        transform: translateY(-20px);
      }
    }  

# Style applies the eyelid closing animation
Eyelid Styles:
  style: 
    style: |
      .eyelid-top
      {
        animation: eyelid-top-animation 8s infinite;
        fill: {{skin2}};
        transform: translateY(0);
      }
      .eyelid-bottom
      {
        animation: eyelid-bottom-animation 8s infinite;
        fill: {{skin2}};
        transform: translateY(0);
      }

Eyelid Left Top:
  rect:
    rect: [100, 20]
    x: 160
    y: 105
    addClass: eyelid-top

Eyelid Right Top:
  rect:
    rect: [100, 20]
    x: 335
    y: 105
    addClass: eyelid-top

Eyelid Left Bottom:
  rect:
    rect: [100, 20]
    x: 160
    y: 165
    addClass: eyelid-bottom

Eyelid Right Bottom:
  rect:
    rect: [100, 20]
    x: 335
    y: 165
    addClass: eyelid-bottom

# Eyebrow closing and raising animations
Eyebrow Animation:
  style: |
    @keyframes eyebrow-close-animation {
      0%, 90%, 100% {
        margin-top: 0px;
      }
      92% {
        margin-top: 10px;
        padding-top: 0px;
      }
    }
    @keyframes eyebrow-raise-animation {
      0%, 87.5%, 92.5%, 100% {
        padding-top: 10px;
      }
      90%, 95% {
        padding-top: 0px;
      }
    }

# Style applies the eyebrow closing and raising animations
Eyebrow Style:
  style: |
    .eyebrow
    {
      animation: eyebrow-close-animation 8s infinite, eyebrow-raise-animation 15s infinite;
      color: {{hair1}};
      padding-top: 0px !important;
    }
    .eyebrow-inner
    {
      border-top: 10px solid {{hair1}};
      width: inherit;
      height: inherit;
      padding-top: inherit;
    }
    .eyebrow-inner, .left {
      border-radius: 45% 30% 0 0;
    }
    .eyebrow-inner, .right {
      border-radius: 30% 45% 0 0;
    }

Eyebrow Left:
  foreignObject: 
    foreignObject: [ 100, 50 ]
    x: 155
    y: 90
    addClass: eyebrow
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml">
        <div class="eyebrow-inner left"></div>
      </html>'

Eyebrow Right:
  foreignObject: 
    foreignObject: [ 100, 50 ]
    x: 335
    y: 90
    addClass: eyebrow
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml">
        <div class="eyebrow-inner right"></div>
      </html>'

Nostrils:
  foreignObject: 
    foreignObject: [ 90, 40 ]
    x: 250
    y: 235
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" style="width: 80px; height: 30px;border-radius: 50% 50% 25% 25%;border: 5px {{nose}} solid; border-style: ridge groove groove ridge"/>'

Nose:
  foreignObject: 
    foreignObject: [ 60, 105 ]
    x: 265
    y: 180
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" style="width: 50px; height: 100px;border-radius: 0 0 35% 35%;border: 5px {{nose}} solid; border-style: none groove groove ridge;background: {{skin2}}"/>'

Lips Animation:
  style: |
    @keyframes mouth-animation-lips {
      30%, 42% {
        height: 62px;
        margin-top: 0px;
      }
      35%, 37% {
        height: 10px;
        margin-top: 12.5px;
      }
    }

Lips Style:
  style: [
    '.lips',
    {
      animation: 'mouth-animation-lips 25s infinite',
      background: 'radial-gradient({{lips1}}, {{lips2}});',
      border-radius: 10% 10% 50% 50%
    },
  ]

Lips:
  foreignObject: 
    foreignObject: [ 160, 62 ]
    x: 220
    y: 328
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="foInherit lips"/>'

Mouth Style:
  style: |
    @keyframes mouth-animation {
      0%, 30%, 42%, 100% {
        height: 50px;
        margin-top: 0px;
      }
      35%, 37% {
        height: 0px;
        margin-top: 11.5px;
      }
    }
    @keyframes mouth-animation-teeth {
      0%, 30%, 41%, 100% {
        height: 100%;
        opacity: 1.0;
      }
      34%, 38% {
        height: 100%;
        opacity: 0.25;
      }
      35%, 37% {
        height: 0%;
        opacity: 0.0;
      }
    }
    .mouth {
      background: {{teeth}};
      border-radius: 10% 10% 50% 50%;
      animation: mouth-animation 25s infinite;
      width: inherit;
      height: inherit;
    }
    .teeth {
      border-collapse: collapse;
      animation: mouth-animation-teeth 25s infinite;
      clip-path: polygon(0% 0%, 100% 0%, 100% 60%, 80% 93%, 50% 105%, 20% 93%, 0% 60%);
      display: content;
      width: 100%;
      position: absolute;
    }
    .teeth td, .teeth th {
      border: 1px solid {{teethOutline}};
    }
    .teeth tr:first-child>td {
      border-top: 0px;
    }
    .teeth tr:last-child>td {
      border-bottom: 0px;
    }
    .teeth td:first-child {
      border-left: 0px;
    }
    .teeth td:last-child {
      border-right: 0px;
    }

Teeth:
  foreignObject: 
    foreignObject: [ 148, 50 ]
    x: 225
    y: 333
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="mouth">
        <div style="width: inherit; height: inherit; position: fixed;">
          <table class="teeth">
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </table>
        </div>
      </html>'

Inner Lips Style:
  style: [
    '.mouth-inner-lips',
    {
      border: '1px solid {{lips1}};',
      animation: 'mouth-animation 25s infinite',
      border-radius: 10% 10% 50% 50%,
      width: calc(100% - 2px),
    },
  ]

Inner Lips:
  foreignObject: 
    foreignObject: [ 150, 52 ]
    x: 224
    y: 332
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="mouth-inner-lips"/>'

Mustache Style:
  style: |
    .mustache {
      border-top: 20px solid {{mustache}};
    }

Mustache:
  foreignObject: 
    foreignObject: [ 200, 70 ]
    x: 200
    y: 295
    css:
      border-radius: 30% 30% 0 0;
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="mustache"/>'

Mustache 2:
  foreignObject: 
    foreignObject: [ 160, 90 ]
    x: 220
    y: 285
    css:
      border-radius: 25% 25% 0 0;
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="mustache"/>'

Sideburn Style:
  style: |
    .sideburn {
      background: {{sideburns}};
      border-radius: 50%;
    }

Left Sideburn:
  foreignObject: 
    foreignObject: [ 30, 90 ]
    x: 95
    y: 180
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="sideburn"/>'

Right Sideburn:
  foreignObject: 
    foreignObject: [ 30, 90 ]
    x: 475
    y: 180
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="sideburn"/>'

Beard Style:
  style: |
    .beard {
      background: {{sideburns}};
    }
    .left1 {
      border-radius: 35% 80% 30% 50%;
    }
    .right1 {
      border-radius: 80% 35% 50% 30%;
    }
    .left2 {
      border-radius: 25% 50% 25% 100%;
    }
    .right2 {
      border-radius: 50% 25% 100% 50%;
    }
    .left3, .right3 {
      border-radius: 100%;
    }
    .beard-bottom {
      border-bottom: 40px solid {{sideburns}};
      border-radius: 100%;
      height: 75%;
    }

Left Beard 1:
  foreignObject: 
    foreignObject: [ 70, 90 ]
    x: 100
    y: 230
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard left1"/>'

Right Beard 1:
  foreignObject: 
    foreignObject: [ 70, 90 ]
    x: 425
    y: 230
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard right1"/>'

Left Beard 2:
  foreignObject: 
    foreignObject: [ 90, 90 ]
    x: 110
    y: 305
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard left2"/>'

Right Beard 2:
  foreignObject: 
    foreignObject: [ 90, 90 ]
    x: 400
    y: 305
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard right2"/>'

Left Beard 3:
  foreignObject: 
    foreignObject: [ 30, 20 ]
    x: 185
    y: 375
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard left3"/>'

Right Beard 3:
  foreignObject: 
    foreignObject: [ 30, 20 ]
    x: 385
    y: 375
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard right3"/>'

Bottom Beard 1:
  foreignObject: 
    foreignObject: [ 300, 200 ]
    x: 150
    y: 270
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard-bottom"/>'

Bottom Beard 2:
  foreignObject: 
    foreignObject: [ 350, 190 ]
    x: 125
    y: 250
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml" class="beard-bottom"/>'

Hand:
  foreignObject: 
    foreignObject: [ 148, 50 ]
    x: 225
    y: 333
    addObject: '<html xmlns="http://www.w3.org/1999/xhtml">
        
      </html>'